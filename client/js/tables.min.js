function carregarEventosTabelaDados(a,t){var e=$("#"+a),o=e.parents().find(".table-add");$(e.children().find("td").get(0)).attr("contenteditable","true"),$(e.children().find("td").get(1)).attr("contenteditable","true"),o.unbind(),o.click(function(){t.row.add({id:"",nome:"",valor:"",excluir:"<span class='table-remove'><button type='button' class='btn btn-danger btn-rounded btn-sm my-0'>Excluir</button></span>"}).draw(),e.children().find("td").attr("contenteditable","true"),e.children().find("td").attr("contenteditable","true"),carregarEventoDeleteTabelaDados(a,t)}),carregarEventoDeleteTabelaDados(a,t)}function carregarEventoDeleteTabelaDados(a,t){$("#"+a+" .table-remove").unbind(),$("#"+a+" tbody tr").focusout(function(){var a=$(this).find("td"),e=$(a.get(0)).text(),o=$(a.get(1)).text(),i=t.row(this).data(),n=i.id;i.nome=e,i.valor=o,$.ajax({url:"http://localhost/TCC/Waiter/server/php/dadosPessoais.php?method=salvar",data:{idUsuario:getCookie("idUsuario"),id:n,nome:e,valor:o},success:function(a){n=$(a).find("id").text(),i.id=n},error:function(a,t,e){$.alert("<h6>Houve um erro ao tentar salvar os dados.</h6>")}})}),$("#"+a+" .table-remove").click(function(){var e=t.row($(this).parents("tr")).data().id;e.length>0&&$.confirm({title:"",content:"<h6>Confirma exclusão do dado?</h6>",buttons:{confirma:{btnClass:"btn-red",action:function(){$.ajax({url:"http://localhost/TCC/Waiter/server/php/dadosPessoais.php?method=excluir",data:{idUsuario:getCookie("idUsuario"),id:e},success:function(t){carregarTabelaDados(a)},error:function(a,t,e){$.alert(e)}})}},cancela:{}}})})}function carregarTabelaDados(a){$table=$("#"+a).DataTable({columns:[{data:"id",visible:!1,defaultContent:""},{data:"nome",defaultContent:""},{data:"valor",defaultContent:""},{data:"excluir",defaultContent:""}],retrieve:!0,paging:!1,bInfo:!1,language:{search:"Procurar:"}}),$table.rows().remove(),$table.rows().draw(),carregarEventosTabelaDados(a,$table),$.ajax({url:"http://localhost/TCC/Waiter/server/php/dadosPessoais.php?method=obterCamposUsuario",data:{identificadorUsuario:getCookie("identificadorUsuario"),senha:getCookie("senha")},success:function(t){$(t).find("obterCamposUsuario").each(function(){$(this).children().each(function(){var t=$(this).get(0).tagName;if("status"!=t&&"response"!=t){var e=$(this).find("id").text(),o=$(this).find("nome").text(),i=$(this).find("valor").text();$table.row.add({id:e,nome:o,valor:i,excluir:"<span class='table-remove'><button type='button' class='btn btn-danger btn-rounded btn-sm my-0'>Excluir</button></span>"}).draw(),carregarEventosTabelaDados(a,$table)}})})},error:function(a,t,e){console.log(e)}})}function carregarEventosTabelaSolicitacoes(a,t,e){carregarEventoAcceptTabelaSolicitacoes(a,t,e),carregarEventoDeleteTabelaSolicitacoes(a,t,e),carregarEventoDetailTabelaSolicitacoes(a,t,e)}function carregarEventoDetailTabelaSolicitacoes(a,t,e){$(".data-item").unbind(),$(".data-item").magnificPopup({type:"inline",preloader:!1,focus:"#solicitationsTableList",modal:!0}),$(".data-item").on("click",function(){var a=t.row($(this).parents("tr")).data().campos;carregarTabelaDetalhaSolicitacao(e,a)}),$(document).on("click",".data-modal-dismiss",function(a){a.preventDefault(),$.magnificPopup.close()})}function carregarEventoAcceptTabelaSolicitacoes(a,t,e){$("#"+a+" .table-accept").unbind(),$("#"+a+" .table-accept").click(function(){var o=t.row($(this).parents("tr")).data().id;o.length>0&&$.confirm({title:"",content:"<h6>Confirma autorização de acesso?</h6>",buttons:{confirma:{btnClass:"btn-green",action:function(){$.ajax({url:"http://localhost/TCC/Waiter/server/php/solicitacaoAcesso.php?method=autorizar",data:{identificadorUsuario:getCookie("identificadorUsuario"),senha:getCookie("senha"),idSolicitacao:o},success:function(t){carregarTabelaSolicitacoes(a,e)},error:function(a,t,e){$.alert(e)}})}},cancela:{}}})})}function carregarEventoDeleteTabelaSolicitacoes(a,t,e){$("#"+a+" .table-remove").unbind(),$("#"+a+" .table-remove").click(function(){var o=t.row($(this).parents("tr")).data().id;o.length>0&&$.confirm({title:"",content:"<h6>Confirma exclusão da solicitação?</h6>",buttons:{confirma:{btnClass:"btn-red",action:function(){$.ajax({url:"http://localhost/TCC/Waiter/server/php/solicitacaoAcesso.php?method=excluir",data:{id:o},success:function(t){carregarTabelaSolicitacoes(a,e)},error:function(a,t,e){$.alert(e)}})}},cancela:{}}})})}function carregarTabelaSolicitacoes(a,t){$solicitationsTable=$("#"+a).DataTable({columns:[{data:"id",visible:!1,defaultContent:""},{data:"campos",visible:!1,defaultContent:""},{data:"solicitacoes",defaultContent:""},{data:"detalhar",defaultContent:""},{data:"aceitar",defaultContent:""},{data:"recusar",defaultContent:""}],retrieve:!0,paging:!1,searching:!1,bInfo:!1}),$solicitationsTable.rows().remove(),$solicitationsTable.rows().draw(),carregarEventosTabelaSolicitacoes(a,$solicitationsTable,t),$.ajax({url:"http://localhost/TCC/Waiter/server/php/solicitacaoAcesso.php?method=obterSolicitacoesUsuario",data:{identificadorUsuario:getCookie("identificadorUsuario")},success:function(e){$(e).find("obterSolicitacoesUsuario").each(function(){$(this).children().each(function(){var e=$(this).get(0).tagName;if("status"!=e&&"response"!=e){var o=$(this).find("id").text(),i=$(this).find("aceita").text(),n=$(this).find("nomeEntidade").text(),r=$(this).find("dadosPessoais").children(),c=r.length,s=n+" ( "+c;s+=c>1?" Campos )":" Campo )";var l=[];r.each(function(){l[l.length]=$(this).text()});var d="<span class='table-accept'><button type='button' class='btn btn-success btn-rounded btn-sm my-0'>Aceitar</button></span>";1==i&&(d="<h6>Autorizada</h6>"),$solicitationsTable.row.add({id:o,campos:l,solicitacoes:s,detalhar:"<span class='table-detail'><a class='data-item d-block mx-auto' href='#data-modal'><button type='button' class='btn btn-info btn-rounded btn-sm my-0'>Detalhar</button></a></span>",aceitar:d,recusar:"<span class='table-remove'><button type='button' class='btn btn-danger btn-rounded btn-sm my-0'>Recusar</button></span>"}).draw(),carregarEventosTabelaSolicitacoes(a,$solicitationsTable,t)}})})},error:function(a,t,e){console.log(e)}})}function carregarTabelaDetalhaSolicitacao(a,t){var e=$("#"+a).find("tbody");e.find("tr").detach();for(i in t){var o=t[i],n="<tr";i%2!=0&&(n+=" style='background-color: #FFFFFF;'"),n+="><td>"+o+"</td><tr>",e.append(n)}}